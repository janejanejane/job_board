<% provide(:title, 'User profile') %>
<h1>User profile</h1>

<% content_for :tab_header do %>
  <li><%= link_to "Jobs", jobs_path %></li>
  <li><%= link_to "Users", users_path %></li>
<% end %>

<div class="row-fluid">
	<%= render 'shared/error_messages', object: @user %>
	<table>
		<tbody>
			<tr>
				<td>
					<label>Photo</label>
				</td>
				<td>
					<img src="<%= "#{@user.image}" %>" >
				</td>
			</tr>
			<tr>
				<td>
					<label>Nickname</label>
				</td>
				<td>
					<%= @user.nickname %>
				</td>
			</tr>
			<tr>
				<td>
					<label>First Name</label>
				</td>
				<td>
					<%= @user.first_name %>
				</td>
			</tr>
			<tr>
				<td>
					<label>Last Name</label>
				</td>
				<td>
					<%= @user.last_name %>
			  </td>
			</tr>
			<tr>
				<td>
					<label>Personal Statement</label>
				</td>
				<td>
		      <%= @user.personal_statement %>
		    </td>
			</tr>
			<tr>
				<td>
					<label>Location</label>
				</td>
				<td>
		      <%= @user.location %>
		    </td>
			</tr>
			<% if !@user.job_preference.nil? %>
			<tr>
				<td>
					<label>Job Skills</label>
				</td>
				<td>
			    <%	format_job_pref # call users_helper method that creates @user_upvotes 
			    		if !@user_upvotes.blank? %>
				    	<table class="upvotes">
				    		<% @user_upvotes.keys.each do |jobpref|  %>
				      		<tr>
				      			<td>
				      				<%= jobpref %> 

				      				<% if(!@job_preference.empty?)
							    				CATEGORY.each_with_index do |choice, index| 
														if(@job_preference.index{|d| d == index.to_s}) # checks if index is not nil
															if choice == jobpref %>
				      				<sup>(preferred)</sup>
				      				<% 			end
				      							end
				      						end
				      					end	%>
				      					
				      				<%= @user_upvotes[jobpref][:points].html_safe %>
				      			</td>
				      			<td class="pull-right"><%= @user_upvotes[jobpref][:voters].html_safe %></td>
				      		</tr>
				      	<% end %>
				    	</table>			    	
				    <% end %>
		    </td>
			</tr>
			<% end %>
	<% if !@user_extra.blank? %>
			<tr>
				<td colspan="2">
					<legend>Additional Information</legend>
				</td>
			</tr>
			<tr>
				<td>
					<label>Special Title</label>
				</td>
				<td>
					<%= @user_extra.special_title %>
				</td>
			</tr>
			<tr>
				<td>
					<label>Experience</label>
				</td>
				<td>
		      <%= pluralize((Time.now.year - @user_extra.experience), "year") %>
		    </td>
			</tr>
			<% if !@user_extra.behance.blank? %>
			<tr>
				<td>
					<label>Behance</label>
				</td>
				<td>
					<%= @user_extra.behance %>
				</td>
			</tr>
			<% end 
			if !@user_extra.deviantart.blank? %>
			<tr>
				<td>
					<label>Deviantart</label>
				</td>
				<td>
					<%= @user_extra.deviantart %>
				</td>
			</tr>
			<% end
			if !@user_extra.kongregate.blank? %>
			<tr>
				<td>
					<label>Kongregate</label>
				</td>
				<td>
		      <%= @user_extra.kongregate %>
		    </td>
			</tr>
			<% end
			if !@user_extra.gamasutra.blank? %>
			<tr>
				<td>
					<label>Gamasutra</label>
				</td>
				<td>
					<%= @user_extra.gamasutra %>
				</td>
			</tr>
			<% end
			if !@user_extra.newgrounds.blank? %>
			<tr>
				<td>
					<label>Newgrounds</label>
				</td>
				<td>
		      <%= @user_extra.newgrounds %>
		    </td>
			</tr>
			<% end
			if !@user_extra.gamejolt.blank? %>
			<tr>
				<td>
					<label>Gamejolt</label>
				</td>
				<td>
					<%= @user_extra.gamejolt %>
				</td>
			</tr>
		<% end 
		end %>
		</tbody>
	</table>
		<% counter = 0 
			if !@games.blank? %>

	<legend>Games</legend>
				
		<%	@games.each do |game| 
					if counter < 3 %>
				 		<%= render 'shared/game_list', object: game %>
					<% counter += 1
				 	end 
				end
				if @games.length > 3 %>
				<span class="pull-right"><%= link_to "More games...", user_games_path(@user), class: "btn btn-primary" %></span>
		<% 	end %>
		<% end %>
</div>
